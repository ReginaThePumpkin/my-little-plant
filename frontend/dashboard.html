<!DOCTYPE html>
<html>
    <head>

        <title>MyLittlePlant | Tu planta contectada a internet</title>

        <!-- Metas -->
        <meta name="viewport" content="width=device-width, initial-scale=1">
		<meta name="author" content="Cornugs, Allegue y Llolloz" >
		<meta name="keywords" content="Plantas, Internet of Things, Tec de Monterrey, ITESM">
        <meta name="description" content="Plataforma para monitorear plantas con iot">
        <!-- End of metas -->
        
		<meta name="ROBOTS" content="NOINDEX, NOFOLLOW">
		<meta http-equiv="content-type" content="text/html; charset=UTF-8">
		<meta http-equiv="content-type" content="application/xhtml+xml; charset=UTF-8">
        <meta http-equiv="content-style-type" content="text/css">

        <!-- Icon -->
        <link rel="icon" type="image/png" href="img/icon.png">
        <!---->
        
        <!-- JS Stuff -->
        <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>
        <!-- End of JS Stuff -->

        <!--====== Magnific Popup CSS ======-->
        <link rel="stylesheet" href="assets/css/magnific-popup.css">
                
        <!--====== Slick CSS ======-->
        <link rel="stylesheet" href="assets/css/slick.css">
            
        <!--====== Line Icons CSS ======-->
        <link rel="stylesheet" href="assets/css/LineIcons.css">
            
        <!--====== Bootstrap CSS ======-->
        <link rel="stylesheet" href="assets/css/bootstrap.min.css">

        <!--====== Default CSS ======-->
        <link rel="stylesheet" href="assets/css/default.css">

        <!--====== Style CSS ======-->
        <link rel="stylesheet" href="assets/css/style.css">

        <!-- CSS Stuff -->
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="stylesheet" type="text/css" href="css/plant-modal.css">
        <link rel="stylesheet" type="text/css" href="css/main.css">
        <link rel="stylesheet" type="text/css" href="css/responsive_header.css">
        <link rel="stylesheet" type="text/css" href="css/tabs.css">

        <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700" rel="stylesheet">
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">

        <!-- End of CSS Stuff -->

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

</head>

<body>
<!--[if IE]>
<p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
<![endif]-->



<!--====== NAVBAR TWO PART START ======-->

<section class="navbar-area">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <nav class="navbar navbar-expand-lg">
                   
                    <a class="navbar-brand" href="#">
                        <img src="assets/images/loguito.png" alt="Logo">
                    </a>
                    
                    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarTwo" aria-controls="navbarTwo" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="toggler-icon"></span>
                        <span class="toggler-icon"></span>
                        <span class="toggler-icon"></span>
                    </button>

                    <div class="collapse navbar-collapse sub-menu-bar" id="navbarTwo">
                        <ul class="navbar-nav m-auto">
                            <li class="nav-item active"><a class="page-scroll" href="#home">Mis plantas</a></li>
                            <!--li class="nav-item"><a class="page-scroll" href="#services">Mi historia</a></li-->
                            <!--li class="nav-item"><a class="page-scroll" href="#portfolio">Planes</a></li>
                            <li class="nav-item"><a class="page-scroll" href="#pricing">Nosotros</a></li-->
                            <li class="nav-item"><a class="page-scroll" href="#about">API Rest</a></li>
                        </ul>
                    </div>

                    <!--div class="navbar-btn d-none d-sm-inline-block">
                        <ul>
                            <li><img height="40px" src="./img/options.png" alt="Logo"></li>
                        </ul>
                    </div-->
                </nav> <!-- navbar -->
            </div>
        </div> <!-- row -->
    </div> <!-- container -->
</section>
<br><br><br>

<!--====== NAVBAR TWO PART ENDS ======-->

        <!-- HEADER >
        <div class="header">
            <a href="#default" class="logo">MyLittlePlant.com</a>
            <div class="header-right">
                <a href="#home">Home</a>
                <a href="#contact">Contact</a>
                <a href="#about">About</a>
            </div>
        </div>
        <!-- END OF HEADER -->
        <br>

        <div class="tab-buttons">
            <button class="tablinks" onclick="openTab(event, 'Cactusito')">Cactusito</button>
            <!--button class="tablinks" onclick="openTab(event, 'Papayo')">Papayo</button-->
            <button class="tablinks" onclick="openRegister(event, 'Register')">+</button>
            </div><div class="tab">
        </div>

        <div id="Cactusito" class="tabcontent">
            <table><tr>
            <td>
                <table class="charts" style="height: 20%;">
                    <tr>
                        <td>
                            <div class="chart" style="width: 100%; border-radius: 3px; background-color: #272522;">
                                <canvas id="lum-chart" width="" height="150px"></canvas>
                            </div>
                        </td>
                        <td>
                            <div class="chart" style="width: 100%; border-radius: 3px; background-color: #272522;">
                                <canvas id="hum-chart" width="" height="150px"></canvas>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <div class="chart" style="width: 100%; border-radius: 3px; background-color: #272522;">
                                <canvas id="temp-chart" width="" height="150px"></canvas>
                            </div>
                        </td>
                        <td>
                            <div class="chart" style="width: 100%; border-radius: 3px; background-color: #272522;">
                                <canvas id="earth-hum-chart" width="" height="150px"></canvas>
                            </div>
                        </td>
                    </tr>
                </table>
            </td>
            <td width="40px"></td>
            <td>
                <table class="info_table">
                    <tr style="border-bottom: 3px solid #312e2b;">
                        <th colspan="3" style="font-size:20px ;">Información</th>
                    </tr>
                    <tr style="border-bottom: 2px solid #312e2b;"><th colspan="3">Datos de la planta</th><td></td></tr>
                    <tr>
                        <td><image height="20px" src="./img/plant_1.png"></image></td>
                        <td colspan="2"><p id="plantName">Nombre de la planta</p></td><td></td> 
                    </tr>
                    <tr>
                        <td><image height="20px" src="./img/cactus.png"></image></td>
                        <td colspan="2"><p id="plantSpecie">Especie de planta</p></td><td></td>
                    </tr>
                    <tr>
                        <td><image height="20px" src="./img/light_2.png"></image></td>
                        <td colspan="2"><p id="plantType">Tipo de planta</p></td><td></td>
                    </tr>
                    <tr style="border-bottom: 2px solid #312e2b;"><th colspan="3">Ultimas lecturas</th><td></td></tr>
                    <tr>
                        <td><image height="20px" src="./img/dht_hum.png"></image></td>
                        <td><p id="dht_hum">Humedad en el aire</p></td>
                        <td><p id="dht_hum_l"></p></td>
                    </tr>
                    <tr>
                        <td><image height="20px" src="./img/dht_temp.png"></image></td>
                        <td><p id="dht_temp">Temperatura ambiente</p></td>
                        <td><p id="dht_temp_l"></p></td>
                    </tr>
                    <tr>
                        <td><image height="20px" src="./img/light.png"></image></td>
                        <td><p id="light">Intensidad de luz solar</p></td>
                        <td><p id="light_l"></p></td>
                    </tr>
                    <tr>
                        <td><image height="20px" src="./img/higrometro.png"></image></td>
                        <td><p id="higrometro">Humedad en tierra</p></td>
                        <td><p id="higrometro_l"></p></td>
                    </tr>
                </table>
            </td>
            </tr></table>
            
        </div>

        <!--div id="Papayo" class="tabcontent">
            <div id="chart_0" class="chart" style="width: 40%; border-radius: 3px; background-color: #272522;">
                <canvas id="bar-chart" width="" height="100px"></canvas>
            </div>
        </div-->

        <div id="Register" class="tabcontent">
            <!-- REGISTRATION MODAL BEGINS -->            
            <div class="testbox">
                <form action="/register">
                  <div class="banner">
                    <h1>Registra tu plantita :)</h1>
                  </div>
                  <h2>Detalles de la plantita</h2>
                  <div class="item">
                    
                    <p>Nombre (El nombre común de la palntita)</p>
                    <div class="name-item">
                      <input type="text" name="name" placeholder="Nombre"/>
                    </div>

                    <p>Código de la planta</p>
                    <div class="name-item">
                        <input type="text" name="qrcode" placeholder="QR de la plantita"/>
                    </div>

                  </div>
                  <div class="item">
                    <p>Nickname</p>
                    <input type="text" name="name" placeholder="Escoge un nombre personal a tu plantita" />
                  </div>
                  <div class="item">
                     <select>
                          <option value="">Tipo de plantita</option>
                          <option value="luz">Luz</option>
                          <option value="sombra">Sombra</option>
                      </select>
                      <select>
                          <option value="">Especie</option>
                          <option value="frutal">Frutal</option>
                          <option value="floral">Floral</option>
                          <option value="cactacea">Cactacea</option>
                          <option value="arbol">Arbol</option>
                      </select>
                  </div>
                  <div class="question">
                    <p>Políticas de privacidad<span class="required">*</span></p>
                    <div class="question-answer checkbox-item">
                      <div>
                        <input type="checkbox" value="none" id="check_1" name="check" required/>
                        <label for="check_1" class="check"><span>Acepto <a href="">enviarle mis datos a Rusia :).</a></span></label>
                      </div>
                    </div>
                  </div>
                  <div class="btn-block">
                    <button type="submit" href="/">Listo</button>
                  </div>
                </form>
              </div>
        </div>
        <!-- REGISTRATION MODAL ENDS -->
        
    </body>
    <script>
        function openRegister(evt, plantName) {
            var i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tabcontent");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }
            tablinks = document.getElementsByClassName("tablinks");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }
            document.getElementById(plantName).style.display = "block";
            evt.currentTarget.className += " active";
        }
    </script>
    <script>
        function openTab(evt, plantName) {
            var i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tabcontent");

            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }

            tablinks = document.getElementsByClassName("tablinks");

            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }

            document.getElementById(plantName).style.display = "block";//Muestra la cosao esa


            /* GETTING PLANT INFO*/
            $.ajax({
                url: 'api/plant-byname/'+plantName,
                dataType: 'json',
                success: function(response) {
                    document.getElementById("plantName").innerHTML = response[0]["namePlant"];
                    document.getElementById("plantType").innerHTML = response[0]["type"];
                    document.getElementById("plantSpecie").innerHTML = response[0]["species"];
                }
            });
            /* GETTING PLANT STATS*/
            $.ajax({
                url: 'api/plant-last-status/JSHD23S2',
                dataType: 'json',
                success: function(response) {
                    document.getElementById("dht_hum_l").innerHTML = response[0]["humidity"];
                    document.getElementById("dht_temp_l").innerHTML = response[0]["temperature"];
                    document.getElementById("light_l").innerHTML = response[0]["luminosity"];
                    document.getElementById("higrometro_l").innerHTML = response[0]["earthHumidity"];
                }
            });
            /*GETTING LUMINOSITY CHART*/
            $.ajax({
                url: 'api/plant-luminosity-byname/'+plantName,
                //type: 'post',
                //data: {'username' : username, 'password' : password},
                dataType: 'json',
                success: function(response) {
                    //alert(response)
                    var _labels = [];
                    var _data = [];
                    for (i = 0; i < 20; i++) {
                        console.log(response[i]);
                        _labels[i]=response[i]["registrationTime"];
                        _data[i] = response[i]["luminosity"];
                    }
                    new Chart(document.getElementById("lum-chart"), {
                        type: 'line',
                        data: {
                        labels: _labels,
                        datasets: [
                            {
                            label: "Luminosidad",
                            backgroundColor: "#82f60f",
                            data: _data
                            }
                        ]
                        },
                        options: {
                        legend: { display: false },
                        title: {
                            display: true,
                            text: 'Luminosidad'
                        }
                        }
                    });
                }
            });
            /*GETTING TEMPERATURE CHART*/
            $.ajax({
                url: 'api/plant-temperature-byname/'+plantName,
                //type: 'post',
                //data: {'username' : username, 'password' : password},
                dataType: 'json',
                success: function(response) {
                    //alert(response)
                    var _labels = [];
                    var _data = [];
                    for (i = 0; i < 20; i++) {
                        console.log(response[i]);
                        _labels[i]=response[i]["registrationTime"];
                        _data[i] = response[i]["temperature"];
                    }
                    new Chart(document.getElementById("temp-chart"), {
                        type: 'line',
                        data: {
                        labels: _labels,
                        datasets: [
                            {
                            label: "Temperatura",
                            backgroundColor: "#82f60f",
                            data: _data
                            }
                        ]
                        },
                        options: {
                        legend: { display: false },
                        title: {
                            display: true,
                            text: 'Temperatura'
                        }
                        }
                    });
                }
            });
            /*GETTING HUMIDITY CHART*/
            $.ajax({
                url: 'api/plant-humidity-byname/'+plantName,
                //type: 'post',
                //data: {'username' : username, 'password' : password},
                dataType: 'json',
                success: function(response) {
                    //alert(response)
                    var _labels = [];
                    var _data = [];
                    for (i = 0; i < 20; i++) {
                        console.log(response[i]);
                        _labels[i]=response[i]["registrationTime"];
                        _data[i] = response[i]["humidity"];
                    }
                    new Chart(document.getElementById("hum-chart"), {
                        type: 'line',
                        data: {
                        labels: _labels,
                        datasets: [
                            {
                            label: "Humedad en el aire",
                            backgroundColor: "#82f60f",
                            data: _data
                            }
                        ]
                        },
                        options: {
                        legend: { display: false },
                        title: {
                            display: true,
                            text: 'Humedad en el aire'
                        }
                        }
                    });
                }
            });
            /*GETTING EARTH HUMIDITY CHART*/
            $.ajax({
                url: 'api/plant-earth-humidity-byname/'+plantName,
                //type: 'post',
                //data: {'username' : username, 'password' : password},
                dataType: 'json',
                success: function(response) {
                    //alert(response)
                    var _labels = [];
                    var _data = [];
                    for (i = 0; i < 20; i++) {
                        console.log(response[i]);
                        _labels[i]=response[i]["registrationTime"];
                        _data[i] = response[i]["earthHumidity"];
                    }
                    new Chart(document.getElementById("earth-hum-chart"), {
                        type: 'line',
                        data: {
                        labels: _labels,
                        datasets: [
                            {
                            label: "Humedad en tierra",
                            backgroundColor: "#82f60f",
                            data: _data
                            }
                        ]
                        },
                        options: {
                        legend: { display: false },
                        title: {
                            display: true,
                            text: 'Humedad en tierra'
                        }
                        }
                    });
                }
            });


            evt.currentTarget.className += " active";
        }
    </script>
    
    <script>
        // document.getElementById("txt1").innerHTML = "Texto de prueba"
        $(document).ready(() => {

            //$("#txt1").html("Texto de prueba")
            
            var valores = []
            var valoresX = []
            $.ajax({
                //Se pueden enviar valores por el URL (no recomendado, por seguridad)
                //https://iot.omarquintero.com/equipo6/api/sensors?valor1=5&valor2=texto
                url: 'https://iot.omarquintero.com/equipo6/api/sensors',
                method: 'GET',
                success: (result) => {
                    console.log(result);
                    //result.length
                    $("#txt1").html(result[result.length-1].luminosity);
                    valores.push(result[result.length-5].luminosity)
                    valores.push(result[result.length-4].luminosity)
                    valores.push(result[result.length-3].luminosity)
                    valores.push(result[result.length-2].luminosity)
                    valores.push(result[result.length-1].luminosity)

                    valoresX.push(result[result.length-5].registrationTime)
                    valoresX.push(result[result.length-4].registrationTime)
                    valoresX.push(result[result.length-3].registrationTime)
                    valoresX.push(result[result.length-2].registrationTime)
                    valoresX.push(result[result.length-1].registrationTime)

                    //var contenedor = $("#grafica");
                    var contenedor = document.getElementById("grafica");
                    //datos
                    
                    var grafica = new Chart(contenedor, {
                        type: 'line',
                        data: {
                            labels: valoresX,
                            datasets: [{
                                label: 'luminosity',
                                data: valores,
                                backgroundColor: 'rgba(0,0,0,0)',
                                borderColor: 'rgba(0,100,100,1)',
                                borderWidth: 2
                            }]
                        }
                    })
                },
                error: (xhr, status, error) => {
                    console.log(error);
                }
            });            

        })
    </script>
</html>
